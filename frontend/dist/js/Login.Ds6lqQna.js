import{R as _,d as F,u as b,k,A as y,S as c,r as m,c as w,o as V,Q as i,a as n,J as v}from"./vendor.b7dnWdBk.js";import{g as B,b as I,s as R,l as L,c as S,d as $,a as A}from"./index.D4oiYhMT.js";const C=async()=>{const e=B();if(["undefined",null,void 0].includes(e))try{const r=(await I()).data;if(r&&r.pub_key)return R(r.pub_key),r.pub_key}catch(s){console.error("Error fetching public key:",s)}return e},E=async e=>{const s=await C(),r=new _;return r.setPublicKey(s),r.encrypt(JSON.stringify(e))},K=F({name:"Login",setup(){const e=b(),s=k(),r=y({email:localStorage.getItem("user")||"",pass:""}),d=y({email:[{required:!0,message:"请输入邮箱地址/用户名",trigger:"blur"}],pass:[{validator:(o,a,t)=>{a?t():t(new Error("请输入密码"))},trigger:"blur"}]}),f=o=>/^[a-zA-Z0-9._-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,4}$/.test(o),l=async o=>{const a=await E(o),u=(await L({encrypted:a})).data;if(u.success==!1){c.error(u.err);return}else c.success("登录成功"),S(u.token),$(u.refreshToken),o.email?localStorage.setItem("user",o.email):localStorage.setItem("user",o.username),e.push("/home")};return{ruleFormRef:s,ruleForm:r,rules:d,submitForm:o=>{o&&o.validate(a=>{if(a){let t={};f(r.email)?t={email:r.email,pass:r.pass}:t={username:r.email,pass:r.pass},l(t)}else c.error("输入格式不正确")})}}}});function P(e,s,r,g,d,f){const l=m("el-input"),p=m("el-form-item"),o=m("el-button"),a=m("el-form");return V(),w(a,{model:e.ruleForm,"status-icon":"",rules:e.rules,ref:"ruleFormRef",class:"demo-ruleForm"},{default:i(()=>[n(p,{prop:"email"},{default:i(()=>[n(l,{modelValue:e.ruleForm.email,"onUpdate:modelValue":s[0]||(s[0]=t=>e.ruleForm.email=t),placeholder:"邮箱/用户名"},null,8,["modelValue"])]),_:1}),n(p,{prop:"pass"},{default:i(()=>[n(l,{type:"password",modelValue:e.ruleForm.pass,"onUpdate:modelValue":s[1]||(s[1]=t=>e.ruleForm.pass=t),placeholder:"密码",autocomplete:"off"},null,8,["modelValue"])]),_:1}),n(o,{type:"primary",onClick:s[2]||(s[2]=t=>e.submitForm(e.ruleFormRef))},{default:i(()=>s[3]||(s[3]=[v(" 登陆 ")])),_:1})]),_:1},8,["model","rules"])}const z=A(K,[["render",P],["__scopeId","data-v-5da06d43"]]);export{z as default};
